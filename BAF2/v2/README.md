# Go Authentication Framework for Hyperledger Fabric

This project provides a complete Go-based authentication framework for Hyperledger Fabric with Kerberos-like authentication for IoT devices.

## Components

1. **Standalone Authentication Framework (`standalone-auth-framework.go`)**: 
   - Provides key generation in PKCS#1 format
   - Simulates authentication flow for testing
   - Provides debugging utilities

2. **Simple Fabric Client (`simple-fabric-client.go`)**: 
   - Interacts with Hyperledger Fabric network
   - Uses keys generated by the standalone framework
   - Implements the Kerberos-like authentication flow

3. **Wrapper Script (`fabric-wrapper.sh`)**: 
   - Integrates the standalone framework with the Fabric client
   - Provides a unified command-line interface

## Quick Start

```bash
# Make the wrapper script executable
chmod +x fabric-wrapper.sh

# Register a client and device
./fabric-wrapper.sh register-client client1
./fabric-wrapper.sh register-device device1 temperature humidity

# Authenticate a client to access a device
./fabric-wrapper.sh authenticate client1 device1

# Get device data and close session
./fabric-wrapper.sh get-device-data client1 device1
./fabric-wrapper.sh close-session client1 device1
```

## Authentication Flow

The framework implements a Kerberos-like authentication protocol:

1. **Client Registration**: Generate RSA keys and register with Authentication Server (AS)
2. **Device Registration**: Generate RSA keys and register IoT device with capabilities
3. **Authentication**:
   - Get nonce challenge from AS
   - Sign the nonce with client's private key
   - Verify client identity with AS
   - Get Ticket Granting Ticket (TGT) from AS
   - Get Service Ticket from Ticket Granting Server (TGS)
   - Validate Service Ticket with IoT Service Validator (ISV)
   - Process service request to access IoT device

## Using the Components Separately

### Standalone Authentication Framework

```bash
# Generate keys for a client
go run standalone-auth-framework.go generate-keys client1

# Simulate authentication with a nonce
go run standalone-auth-framework.go simulate-auth client1 some-nonce-value

# Debug RSA operations
go run standalone-auth-framework.go debug-rsa some-nonce-value

# Test key path compatibility
go run standalone-auth-framework.go test-keys-uri client1
```

### Simple Fabric Client

```bash
# Register a client with Authentication Server
go run simple-fabric-client.go register-client admin client1

# Register a device with capabilities
go run simple-fabric-client.go register-device admin device1 temperature humidity

# Authenticate client for device access
go run simple-fabric-client.go authenticate admin client1 device1

# Get device data after authentication
go run simple-fabric-client.go get-device-data admin client1 device1

# Close an active session
go run simple-fabric-client.go close-session admin client1 device1
```

## Troubleshooting

### Key Format Issues

If you encounter issues with key compatibility:

```bash
# Debug RSA operations with the actual nonce from the chaincode
./fabric-wrapper.sh debug-rsa actual-nonce-value
```

### Authentication Issues

1. Verify keys are correctly generated:
   ```bash
   ls -la keys/
   ```

2. Check if the standalone authentication simulation works:
   ```bash
   go run standalone-auth-framework.go simulate-auth client1 test-nonce-123
   ```

3. Run the individual steps in the authentication flow manually:
   ```bash
   go run simple-fabric-client.go register-client admin client1
   # Then further steps...
   ```

### Fabric Connection Issues

Check the connection profile (`connection-profile.json`) and verify wallet identities:
   ```bash
   ls -la wallet/
   ```

## Extending the Solution

1. **Add More Security Features**:
   - Implement proper session key encryption/decryption
   - Add support for hardware security modules (HSM)

2. **Improve Fabric Client**:
   - Add support for more chaincode operations
   - Enhance error handling and recovery mechanisms

3. **Integrate with Other Systems**:
   - Connect with external IoT device management systems
   - Add support for identity federation
